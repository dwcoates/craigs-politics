<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>politics</title>
<!-- 2016-12-30 Fri 20:22 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Dodge Coates" />
<style type="text/css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}body{width:95%;margin:2%;font:normal normal normal 17px/1.6em Helvetica,sans-serif;color:#333}@media (min-width:769px){body{width:700px;margin-left:5vw}}.title{margin:auto;color:#000}.subtitle,.title{text-align:center}.subtitle{font-size:medium;font-weight:700}.abstract{margin:auto;width:80%;font-style:italic}.abstract p:last-of-type:before{content:"    ";white-space:pre}.status{font-size:90%;margin:2em auto}[class^=section-number-]{margin-right:.5em}#footnotes{font-size:90%}.footpara{display:inline;margin:.2em auto}.footdef{margin-bottom:1em}.footdef sup{padding-right:.5em}a{color:#527d9a;text-decoration:none}a:hover{color:#035;border-bottom:1px dotted}figure{padding:0;margin:0;text-align:center}img{max-width:100%;vertical-align:middle}@media (min-width:769px){img{max-width:85vw;margin:auto}}.MathJax_Display{margin:0!important;width:90%!important}h1,h2,h3,h4,h5,h6{color:#a5573e;line-height:1.6em;font-family:Georgia,serif}h4,h5,h6{font-size:1em}dt{font-weight:700}table{margin:auto;border-top:2px solid;border-collapse:collapse}table,thead{border-bottom:2px solid}table td+td,table th+th{border-left:1px solid gray}table tr{border-top:1px solid #d3d3d3}td,th{padding:5px 10px;vertical-align:middle}caption.t-above{caption-side:top}caption.t-bottom{caption-side:bottom}th.org-center,th.org-left,th.org-right{text-align:center}td.org-right{text-align:right}td.org-left{text-align:left}td.org-center{text-align:center}code{padding:2px 5px;margin:auto 1px;border:1px solid #ddd;border-radius:3px;background-clip:padding-box;color:#333;font-size:80%}blockquote{margin:1em 2em;padding-left:1em;border-left:3px solid #ccc}kbd{background-color:#f7f7f7;font-size:80%;margin:0 .1em;padding:.1em .6em}.todo{color:red}.done,.todo{font-family:Lucida Console,monospace}.done{color:green}.priority{color:orange}.priority,.tag{font-family:Lucida Console,monospace}.tag{background-color:#eee;font-size:80%;font-weight:400;padding:2px}.timestamp{color:#bebebe}.timestamp-kwd{color:#5f9ea0}.org-right{margin-left:auto;margin-right:0;text-align:right}.org-left{margin-left:0;margin-right:auto;text-align:left}.org-center{margin-left:auto;margin-right:auto;text-align:center}.underline{text-decoration:underline}#postamble p,#preamble p{font-size:90%;margin:.2em}p.verse{margin-left:3%}pre{border:1px solid #ccc;box-shadow:3px 3px 3px #eee;font-family:Lucida Console,monospace;margin:1.2em;padding:8pt}pre.src{overflow:auto;padding-top:1.2em;position:relative;font-size:80%}pre.src:before{background-color:#fff;border:1px solid #000;display:none;padding:3px;position:absolute;right:10px;top:.6em}pre.src:hover:before{display:inline}pre.src-sh:before{content:'sh'}pre.src-bash:before{content:'bash'}pre.src-emacs-lisp:before{content:'Emacs Lisp'}pre.src-R:before{content:'R'}pre.src-org:before{content:'Org'}pre.src-c+:before{content:'C++'}pre.src-c:before{content:'C'}pre.src-html:before{content:'HTML'}pre.example{overflow:auto;padding-top:1.2em;position:relative;font-size:80%}.inlinetask{background:#ffc;border:2px solid gray;margin:10px;padding:10px}#org-div-home-and-up{font-size:70%;text-align:right;white-space:nowrap}.linenr{font-size:smaller}.code-highlighted{background-color:#ff0}#bibliography{font-size:90%}#bibliography table{width:100%}.creator{display:block}@media (min-width:769px){.creator{display:inline;float:right}}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">politics</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Introduction</a></li>
<li><a href="#sec-2">2. Preparing Data</a>
<ul>
<li><a href="#sec-2-1">2.1. Grab Data</a></li>
<li><a href="#sec-2-2">2.2. U.S. Census 2010</a>
<ul>
<li><a href="#sec-2-2-1">2.2.1. Geo Keys</a></li>
<li><a href="#sec-2-2-2">2.2.2. Census Data</a></li>
</ul>
</li>
<li><a href="#sec-2-3">2.3. U.S. 2016 Election</a></li>
<li><a href="#sec-2-4">2.4. Preprocess Data</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Unicode</a>
<ul>
<li><a href="#sec-3-1">3.1. Pennsylvania</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1. Colorado</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. State Popularity</a>
<ul>
<li><a href="#sec-4-1">4.1. Usage</a></li>
<li><a href="#sec-4-2">4.2. Normalization</a></li>
<li><a href="#sec-4-3">4.3. Analysis</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. Patronage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. Post Qualities</a></li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-ipython">%matplotlib inline
<span style="color: #9BA657;">import</span> numpy <span style="color: #9BA657;">as</span> np
<span style="color: #9BA657;">import</span> pandas <span style="color: #9BA657;">as</span> pd
<span style="color: #9BA657;">import</span> scipy
<span style="color: #9BA657;">from</span> scipy <span style="color: #9BA657;">import</span> stats
<span style="color: #9BA657;">import</span> matplotlib <span style="color: #9BA657;">as</span> mpl
<span style="color: #9BA657;">import</span> matplotlib.pyplot <span style="color: #9BA657;">as</span> plt

<span style="color: #9BA657;">import</span> pprint <span style="color: #9BA657;">as</span> pp
<span style="color: #9BA657;">import</span> pickle
<span style="color: #9BA657;">import</span> re

<span style="color: #CFB980;">pd.options.display.max_colwidth</span> = 1000
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Preparing Data</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Grab Data</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">read us data collected by craigcrawler </span>
<span style="color: #CFB980;">usa_raw</span> = pd.read_csv(<span style="color: #84857E;">"data/us.csv"</span>, index_col=0)
<span style="color: #CFB980;">post_count_total_raw</span> = <span style="color: #B9A572;">len</span>(usa_raw)
<span style="color: #CFB980;">post_count_by_state_raw</span> = usa_raw.groupby(<span style="color: #84857E;">"state"</span>).count()[<span style="color: #84857E;">"title"</span>]<span style="color: #6C6B59;">#</span><span style="color: #6C6B59;">.sort_values(ascending=False)</span>
<span style="color: #CFB980;">post_count_by_region_raw</span> = usa_raw.groupby(<span style="color: #84857E;">"region"</span>).count()[<span style="color: #84857E;">"title"</span>]<span style="color: #6C6B59;">#</span><span style="color: #6C6B59;">.sort_values(ascending=False)</span>

<span style="color: #9BA657;">print</span> (<span style="color: #84857E;">"\n{0:,} total posts exctracted from {3:,} regions over {4} "</span>+ 
       <span style="color: #84857E;">"state. The most popular\nstate was {1}, and the most "</span> + 
       <span style="color: #84857E;">"popular region was, surprisingly, {2}."</span>).<span style="color: #B9A572;">format</span>(post_count_total_raw,
                                                        post_count_by_state_raw.index[0],
                                                        post_count_by_region_raw.index[0],
                                                        <span style="color: #B9A572;">len</span>(post_count_by_region_raw),
                                                        <span style="color: #B9A572;">len</span>(post_count_by_state_raw))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> U.S. Census 2010</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>US census data for 2010 from the census bureau
</li>
<li>Census data is not labelled exactly as my data is. Some states are named a little differently,
</li>
</ul>
<p>
and regions are almost never named similarly. These have to be resolved.
</p>
</div>

<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="section-number-4">2.2.1</span> Geo Keys</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Keys for geography stuff. Table is an index table.</span>
<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">These keys are used as index for census table.</span>
<span style="color: #CFB980;">GEO_NAME</span> = <span style="color: #84857E;">"GEO.display-label"</span>
<span style="color: #CFB980;">GEO_KEY</span> = <span style="color: #84857E;">"GEO.id"</span>
<span style="color: #CFB980;">state_keys</span> = pd.read_csv(<span style="color: #84857E;">"data/census/DEC_10_DP_G001_with_ann.csv"</span>)[1:].set_index(GEO_KEY)

<span style="color: #CFB980;">state_keys</span> = state_keys.<span style="color: #B9A572;">filter</span>([GEO_NAME])[:52]
<span style="color: #CFB980;">state_keys</span> = state_keys[state_keys[GEO_NAME]!= <span style="color: #84857E;">"Puerto Rico"</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="section-number-4">2.2.2</span> Census Data</h4>
<div class="outline-text-4" id="text-2-2-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">keys for the census data. Only really care about two of them (there are hundreds):</span>
<span style="color: #CFB980;">TOT_NUM_ID</span> = <span style="color: #84857E;">"HD01_S001"</span> <span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">total number key</span>
<span style="color: #CFB980;">TOT_PER_ID</span> = <span style="color: #84857E;">"HD02_S001"</span> <span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">total percent key</span>

<span style="color: #CFB980;">census</span> = pd.read_csv(<span style="color: #84857E;">"data/census/DEC_10_DP_DPDP1_with_ann.csv"</span>)[1:].set_index(GEO_KEY)

<span style="color: #CFB980;">census</span> = census.<span style="color: #B9A572;">filter</span>([TOT_NUM_ID])
<span style="color: #CFB980;">census</span> = census.join(state_keys, how=<span style="color: #84857E;">"right"</span>)
<span style="color: #CFB980;">census.columns</span> = [<span style="color: #84857E;">"population"</span>, <span style="color: #84857E;">"state"</span>]
census.set_index(<span style="color: #84857E;">"state"</span>, inplace=<span style="color: #B97E56;">True</span>)



<span style="color: #9BA657;">def</span> <span style="color: #CFB980;">correct_stat</span>(s):
    <span style="color: #84857E;">"""</span>
<span style="color: #84857E;">    Some states have extra information for population. </span>
<span style="color: #84857E;">    Example: 25145561(r48514)</span>
<span style="color: #84857E;">    """</span>
    <span style="color: #CFB980;">loc</span> = s.find(<span style="color: #84857E;">"("</span>)
    <span style="color: #9BA657;">return</span> <span style="color: #B9A572;">int</span>(s[:loc] <span style="color: #9BA657;">if</span> loc &gt; 0 <span style="color: #9BA657;">else</span> s)

<span style="color: #CFB980;">census.population</span> = census.population.<span style="color: #B9A572;">apply</span>(correct_stat)
</pre>
</div>

<p>
[5 rows x 375 columns]
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> U.S. 2016 Election</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">import</span> requests
<span style="color: #9BA657;">from</span> scrapy <span style="color: #9BA657;">import</span> Selector

<span style="color: #CFB980;">atlas_url</span> = <span style="color: #84857E;">"http://uselectionatlas.org/RESULTS/data.php?year=2016&amp;datatype=national&amp;def=1&amp;f=1&amp;off=0&amp;elect=0"</span>
<span style="color: #CFB980;">atlas_source</span> = requests.get(atlas_url).text
<span style="color: #CFB980;">select</span> = Selector(text=atlas_source).xpath(<span style="color: #84857E;">'//*[@id="datatable"]/tbody/tr'</span>)

<span style="color: #CFB980;">convert</span> = <span style="color: #9BA657;">lambda</span> s: <span style="color: #B9A572;">int</span>(s.replace(<span style="color: #84857E;">','</span>, <span style="color: #84857E;">''</span>))
<span style="color: #CFB980;">vote_names</span> = <span style="color: #B9A572;">map</span>(<span style="color: #B9A572;">str</span>, select.xpath(<span style="color: #84857E;">'td[3]/a/text()'</span>).extract())
<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Correct name for DC</span>
<span style="color: #CFB980;">vote_names</span>[8] = <span style="color: #84857E;">"District of Columbia"</span>
<span style="color: #CFB980;">clinton_votes</span> = <span style="color: #B9A572;">map</span>(convert, select.xpath(<span style="color: #84857E;">'td[17]/text()'</span>).extract())
<span style="color: #CFB980;">trump_votes</span> = <span style="color: #B9A572;">map</span>(convert, select.xpath(<span style="color: #84857E;">'td[18]/text()'</span>).extract())

<span style="color: #CFB980;">gen_votes</span> = pd.DataFrame({<span style="color: #84857E;">"clinton"</span>: clinton_votes, <span style="color: #84857E;">"trump"</span>: trump_votes}, index=vote_names)

<span style="color: #CFB980;">trump_favor</span> = pd.DataFrame(gen_votes[<span style="color: #84857E;">"trump"</span>]/gen_votes.<span style="color: #B9A572;">sum</span>(axis=1), columns=[<span style="color: #84857E;">"trumpism"</span>], index=vote_names)  
<span style="color: #CFB980;">voting</span> = gen_votes.join(trump_favor).sort_values(<span style="color: #84857E;">"trumpism"</span>, ascending=<span style="color: #B97E56;">False</span>)  

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">for pretty printing</span>
<span style="color: #CFB980;">space</span> = pd.DataFrame([[<span style="color: #84857E;">"------"</span>, <span style="color: #84857E;">"------"</span>, <span style="color: #84857E;">"------"</span>]],index=[<span style="color: #84857E;">"*SPACE*"</span>], columns=voting.columns) 
pd.concat([voting[:5], space, voting[-5:].sort_values(<span style="color: #84857E;">"trumpism"</span>)])
</pre>
</div>

<pre class="example">
                      clinton    trump   trumpism
Wyoming                 55973   174419   0.757053
West Virginia          188794   489371   0.721611
North Dakota            93758   216794   0.698092
Oklahoma               420375   949136   0.693047
Idaho                  189765   409055   0.683102
*SPACE*                ------   ------     ------
District of Columbia   282830    12723  0.0430481
Hawaii                 266891   128847   0.325587
California            8753788  4483810   0.338718
Vermont                178573    95369   0.348136
Massachusetts         1995196  1090893   0.353487
</pre>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Preprocess Data</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Some preprocessing to check data corrupted files
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">print</span> <span style="color: #84857E;">"Data tests... \n\nAssertions Passed\n\n"</span>

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Confirm all expected regions and states present</span>
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(usa_raw[<span style="color: #84857E;">"state"</span>].unique()) == 52 <span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">expected number of states</span>
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(usa_raw[<span style="color: #84857E;">"region"</span>].unique()) == 416  <span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">expected number of regions</span>

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Confirm that there are no posts without regions/states. Not all CL </span>
<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">regions have subregions, so it's okay for null subregions.</span>
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(usa_raw[usa_raw[<span style="color: #84857E;">"state"</span>].isnull()].index) == 0
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(usa_raw[usa_raw[<span style="color: #84857E;">"region"</span>].isnull()].index) == 0

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Find regions/subregions for which there are no posts</span>
<span style="color: #CFB980;">postless_regions</span> = usa_raw[usa_raw[<span style="color: #84857E;">"title"</span>].isnull()]  
<span style="color: #CFB980;">postless_regions_times</span> = usa_raw[usa_raw[<span style="color: #84857E;">"date"</span>].isnull()]

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">not actually an effective test, but good enough</span>
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(postless_regions) == <span style="color: #B9A572;">len</span>(postless_regions_times)

<span style="color: #9BA657;">print</span>((<span style="color: #84857E;">"{0:,} regions/subregions over {1} states without "</span> + 
       <span style="color: #84857E;">"any posts."</span>).<span style="color: #B9A572;">format</span>(<span style="color: #B9A572;">len</span>(postless_regions), postless_regions[<span style="color: #84857E;">"state"</span>].nunique()))
</pre>
</div>

<p>
Drop unneeded data
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Drop empty regions.</span>
<span style="color: #CFB980;">usa</span> = usa_raw.dropna(subset=[<span style="color: #84857E;">"title"</span>, <span style="color: #84857E;">"date"</span>], how=<span style="color: #84857E;">"any"</span>, axis=0)
<span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">len</span>(postless_regions) == <span style="color: #B9A572;">len</span>(usa_raw)-<span style="color: #B9A572;">len</span>(usa)

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Get rid of territories (Guam, Puerto Rico)</span>
<span style="color: #CFB980;">usa</span> = usa[usa[<span style="color: #84857E;">"state"</span>] != <span style="color: #84857E;">"Territories"</span>]
</pre>
</div>

<p>
Confirm Census Data
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">set</span>(usa.state.unique()) == <span style="color: #B9A572;">set</span>(census.index) <span style="color: #9BA657;">and</span> <span style="color: #B9A572;">len</span>(usa.state.unique() == <span style="color: #B9A572;">len</span>(census.index))

<span style="color: #9BA657;">print</span> <span style="color: #84857E;">"Census data complete"</span>
</pre>
</div>

<p>
Confirm Election Data
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">assert</span> <span style="color: #B9A572;">set</span>(usa.state.unique()) == <span style="color: #B9A572;">set</span>(voting.index) <span style="color: #9BA657;">and</span> <span style="color: #B9A572;">len</span>(usa.state.unique() == <span style="color: #B9A572;">len</span>(voting.index))

<span style="color: #9BA657;">print</span> <span style="color: #84857E;">"Voting data complete"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Unicode</h2>
<div class="outline-text-2" id="text-3">
<p>
ascii vs. unicode usage. 
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">def</span> <span style="color: #CFB980;">check_ascii</span>(post):
    <span style="color: #84857E;">"""</span>
<span style="color: #84857E;">    Determines whether a title is encodable as ascii</span>
<span style="color: #84857E;">    """</span>
    <span style="color: #9BA657;">try</span>:
        post.encode(<span style="color: #84857E;">'ascii'</span>)
        <span style="color: #9BA657;">return</span> <span style="color: #B97E56;">True</span>
    <span style="color: #9BA657;">except</span> <span style="color: #A56F4B;">UnicodeError</span>:
        <span style="color: #9BA657;">return</span> <span style="color: #B97E56;">False</span>

<span style="color: #CFB980;">ascii_titles_tv</span> = usa.title.<span style="color: #B9A572;">apply</span>(check_ascii)
<span style="color: #CFB980;">nonascii_posts</span> = usa[~ascii_titles_tv]

<span style="color: #CFB980;">distinct_states</span> = nonascii_posts[<span style="color: #84857E;">"state"</span>].unique()
<span style="color: #9BA657;">print</span> (<span style="color: #84857E;">"{0:,} of {1:,} total posts were non-ascii ({2:.2f}%), confined to {3} "</span>
       + <span style="color: #84857E;">"states."</span>).<span style="color: #B9A572;">format</span>(<span style="color: #B9A572;">len</span>(nonascii_posts),
                       <span style="color: #B9A572;">len</span>(usa),
                       <span style="color: #B9A572;">len</span>(nonascii_posts)/<span style="color: #B9A572;">float</span>(<span style="color: #B9A572;">len</span>(usa)) * 100,
                       <span style="color: #B9A572;">len</span>(distinct_states))
</pre>
</div>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Pennsylvania</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Pennsylvania has was the preeminent outlier in non-ascii usage per-state
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">nonascii_states_count</span> = nonascii_posts.groupby(
    <span style="color: #84857E;">"state"</span>).title.nunique().sort_values(ascending=<span style="color: #B97E56;">False</span>)
<span style="color: #9BA657;">print</span> <span style="color: #84857E;">"\nTop ten most popular unicode states:"</span>
<span style="color: #9BA657;">print</span> nonascii_states_count[:10]

<span style="color: #CFB980;">pennsylvania</span> = nonascii_posts[nonascii_posts[<span style="color: #84857E;">"state"</span>] == <span style="color: #84857E;">"Pennsylvania"</span>]
<span style="color: #9BA657;">print</span> pennsylvania[<span style="color: #84857E;">"title"</span>].tolist()[0]

<span style="color: #9BA657;">print</span>(<span style="color: #84857E;">"\nA single Trump memester seems to be responsible for the chaos "</span> +
      <span style="color: #84857E;">"in Pennsylvania.\n"</span> + <span style="color: #84857E;">"I suspect that these crazy unicode posts "</span> +
      <span style="color: #84857E;">"are mostly done by a very small\nset of people, though there is "</span> +
      <span style="color: #84857E;">"no way to tell."</span>)
<span style="color: #9BA657;">print</span> <span style="color: #84857E;">"\nRandom sample of 5 non-ascii Pennsylvania posts"</span>
<span style="color: #9BA657;">print</span> pennsylvania[<span style="color: #84857E;">"title"</span>][:5]

pennsylvania.groupby(<span style="color: #84857E;">"region"</span>).count()

<span style="color: #CFB980;">post_uniqueness</span> = pennsylvania.title.nunique()/<span style="color: #B9A572;">float</span>(<span style="color: #B9A572;">len</span>(pennsylvania.title))
</pre>
</div>

<p>
=                   title  date  state  subregion
region                                          
harrisburg, PA        11    11     11          0
lancaster, PA         11    11     11          0
philadelphia           1     1      1          0
pittsburgh, PA         1     1      1          0
reading, PA           10    10     10          0
state college, PA     11    11     11          0
york, PA              11    11     11          0
==&lt;pandas.core.groupby.DataFrameGroupBy object at 0x7fa5c0d57250&gt;
==&lt;pandas.core.groupby.DataFrameGroupBy object at 0x7fa5f43f5050&gt;
==Series([], dtype: int64)
==Empty DataFrame
Columns: [title, date, state, region]
Index: []
=* 
</p>
</div>
<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Colorado</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #9BA657;">print</span> <span style="color: #84857E;">"\n\n{0} regions in Colorado"</span>.<span style="color: #B9A572;">format</span>(usa[usa[<span style="color: #84857E;">'state'</span>] == <span style="color: #84857E;">"Colorado"</span>][<span style="color: #84857E;">"region"</span>].nunique())
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> State Popularity</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Usage</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">patronage</span> = pd.DataFrame(usa.groupby(<span style="color: #84857E;">'state'</span>).size(), columns=[<span style="color: #84857E;">"patronage"</span>])

<span style="color: #9BA657;">print</span> <span style="color: #84857E;">"\nTop ten most popular states"</span>
<span style="color: #9BA657;">print</span> usage_by_state[:10]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Normalization</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">cl_by_state</span> = patronage.join(census, how=<span style="color: #84857E;">"inner"</span>)
<span style="color: #CFB980;">usage</span> = cl_by_state.<span style="color: #B9A572;">apply</span>(
    <span style="color: #9BA657;">lambda</span> df: df[<span style="color: #84857E;">"patronage"</span>] / <span style="color: #B9A572;">float</span>(df[<span style="color: #84857E;">"population"</span>]), axis=1)

<span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Weight for mean usage = 1.000</span>
<span style="color: #CFB980;">weight</span> = <span style="color: #B9A572;">float</span>(census.population.mean()/patronage.mean())/1.0605
<span style="color: #CFB980;">weighted_usage</span> = pd.DataFrame((usage * weight),
                               columns=[<span style="color: #84857E;">"popularity"</span>])

<span style="color: #CFB980;">state_usage</span> = pd.concat([cl_by_state, weighted_usage],
                        axis=1).sort_values(<span style="color: #84857E;">"patronage"</span>,
                                            ascending=<span style="color: #B97E56;">False</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Analysis</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Patronage</h4>
<div class="outline-text-4" id="text-4-3-1">
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">pat</span> = state_usage.sort_values(<span style="color: #84857E;">"patronage"</span>, ascending=<span style="color: #B97E56;">True</span>)
<span style="color: #CFB980;">x</span> = np.arange(<span style="color: #B9A572;">len</span>(pat))
<span style="color: #CFB980;">p1</span> = pat.patronage

plt.bar(x, p1)
</pre>
</div>


<div class="figure">
<p><img src="file:///home/dodge/workspace/craig-politics/py6320LXp.png" alt="py6320LXp.png" />
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">p2</span> = pat.popularity

plt.bar(x, p2)
</pre>
</div>


<div class="figure">
<p><img src="file:///home/dodge/workspace/craig-politics/py6320lr1.png" alt="py6320lr1.png" />
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">p2</span> = state_usage.population.sort_values()
<span style="color: #CFB980;">p2.x</span> = np.arange(<span style="color: #B9A572;">len</span>(p2))
<span style="color: #CFB980;">p2.y</span> = p2.values

plt.plot(p2.x, p2.y)
</pre>
</div>

<p>
<img src="file:///home/dodge/workspace/craig-politics/py6320Yhv.png" alt="py6320Yhv.png" />
I expect population to relate to patronage linearly.
</p>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #6C6B59;"># </span><span style="color: #6C6B59;">Getting rid of California</span>
<span style="color: #CFB980;">p1</span> = state_usage.<span style="color: #B9A572;">filter</span>([<span style="color: #84857E;">"population"</span>, <span style="color: #84857E;">"patronage"</span>]).sort_values(<span style="color: #84857E;">"population"</span>, ascending=<span style="color: #B97E56;">False</span>)[1:]

plt.plot(p1[<span style="color: #84857E;">"population"</span>], p1[<span style="color: #84857E;">"patronage"</span>])
</pre>
</div>

<div class="figure">
<p><img src="file:///tmp/image.png" alt="image.png" />
</p>
</div>
<div class="org-src-container">

<pre class="src src-ipython"><span style="color: #CFB980;">states</span> = pat.join(voting).sort_values(<span style="color: #84857E;">"popularity"</span>)

plt.plot(np.arange(<span style="color: #B9A572;">len</span>(states.index)), states.trumpism)
</pre>
</div>


<div class="figure">
<p><img src="file:///tmp/population2.png" alt="population2.png" />
</p>
</div>

<div class="org-src-container">

<pre class="src src-ipython"></pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Post Qualities</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Dodge Coates</p>
<p class="date">Created: 2016-12-30 Fri 20:22</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
